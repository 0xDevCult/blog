---
import { getCollection } from 'astro:content';
import { getPostFrontmatter } from '../utils/get-post-frontmatter.ts';

// Get all posts
const posts = await getCollection('docs', ({ id }) => {
  return id.startsWith('posts/');
});

// Enhance posts with frontmatter from markdown files
const postsWithFrontmatter = posts.map((post) => {
  const frontmatter = getPostFrontmatter(post.id);
  return {
    ...post,
    frontmatter,
  };
});

// Sort by date (newest first)
const sortedPosts = postsWithFrontmatter.sort((a, b) => {
  const dateA = a.frontmatter.date ? new Date(a.frontmatter.date).getTime() : 0;
  const dateB = b.frontmatter.date ? new Date(b.frontmatter.date).getTime() : 0;
  return dateB - dateA;
});

// Get the latest post
const latestPost = sortedPosts[0];

// Determine redirect URL
const redirectUrl = latestPost
  ? `/${latestPost.id.replace(/\.mdx?$/, '')}/`
  : '/posts/welcome-to-devcult-blog/';
---

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Redirecting...</title>
	<meta http-equiv="refresh" content={`0;url=${redirectUrl}`}>
	<script is:inline define:vars={{ redirectUrl }}>
		// Immediate client-side redirect for faster navigation
		window.location.href = redirectUrl;
	</script>
</head>
<body>
	<p>Redirecting to the latest post...</p>
	<p>If you are not redirected automatically, <a href={redirectUrl}>click here</a>.</p>
</body>
</html>
